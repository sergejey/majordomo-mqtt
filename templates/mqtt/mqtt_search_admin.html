<div class="row" style="margin-right: -15px;margin-left: -15px;">
	<div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
		<div class="btn-[#if MQTT_STATUS==1#]success[#else#]danger[#endif#]">
			[#module name="xray" action="service" cycle="mqtt"#]
		</div>
	</div>
	<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 text-right" style="margin-bottom: 15px;">
		<a href="?view_mode=edit_mqtt" class="btn btn-success"><i class="glyphicon glyphicon-plus" style="font-size: 2rem;"></i></a>
		<a href="?view_mode=clear_trash" class="btn btn-danger" title="Delete not linked topics." onclick="return confirm('<#LANG_ARE_YOU_SURE#>');"><i style="font-size: 2rem;" class="glyphicon glyphicon-floppy-remove"></i></a>
		[#if TREE="1"#]
		<a href="?tree=0" class="btn btn-default">
			Списком
		</a>
		[#else#]
		<a href="?tree=1" class="btn btn-default">
			Деревом
		</a>
		[#endif#]
		<a class="btn btn-primary" href="#" onClick="$('#filter').toggle('slow');return false;">
			Фильтр
		</a>
		<a class="btn btn-success" href="#" onClick="$('#api_settings').toggle('slow');return false;">
			<#LANG_SETUP#>
		</a>
	</div>
</div>

<div class="row" style="margin-right: -15px;margin-left: -15px;display:none" id="api_settings">
	<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
		<form action="?" method="post" enctype="multipart/form-data" name="frmEdit" class="form-horizontal" style="border: 1px solid #f2f2f2;padding: 10px;border-radius: 5px;">
			<div class="form-group " style="margin-right: 0px;margin-left: 0px;">
				<label class="col-lg-2 col-md-4" style="max-width: 240px;float: left;padding: 5px 10px 0px 0px;text-align: right;">
					<#LANG_NEW_MQTT_CLIENT#>: <span style="color:red">*</span>
				</label>
				<div class="col-lg-10 col-md-8">
					<input type="text" name="mqtt_client" value="<#MQTT_CLIENT#>" class="form-control">
				</div>
			</div>
			<div class="form-group " style="margin-right: 0px;margin-left: 0px;">
				<label class="col-lg-2 col-md-4" style="max-width: 240px;float: left;padding: 5px 10px 0px 0px;text-align: right;">
					<#LANG_NEW_MQTT_HOST#>: <span style="color:red">*</span>
				</label>
				<div class="col-lg-10 col-md-8">
					<input type="text" name="mqtt_host" value="<#MQTT_HOST#>" class="form-control">
				</div>
			</div>
			<div class="form-group " style="margin-right: 0px;margin-left: 0px;">
				<label class="col-lg-2 col-md-4" style="max-width: 240px;float: left;padding: 5px 10px 0px 0px;text-align: right;">
					<#LANG_NEW_MQTT_PORT#>: <span style="color:red">*</span>
				</label>
				<div class="col-lg-10 col-md-8">
					<input type="text" name="mqtt_port" value="<#MQTT_PORT#>" class="form-control">
				</div>
			</div>
			<div class="form-group " style="margin-right: 0px;margin-left: 0px;">
				<label class="col-lg-2 col-md-4" style="max-width: 240px;float: left;padding: 5px 10px 0px 0px;text-align: right;">
					<#LANG_NEW_MQTT_QUERY#>: <span style="color:red">*</span>
				</label>
				<div class="col-lg-10 col-md-8">
					<input type="text" name="mqtt_query" value="<#MQTT_QUERY#>" class="form-control">
				</div>
			</div>
			
			<div class="form-group " style="margin-right: 0px;margin-left: 0px;">
				<label class="col-lg-2 col-md-4" style="max-width: 240px;float: left;padding: 5px 10px 0px 0px;text-align: right;">
					<#LANG_NEW_MQTT_REQ_AUTH#>:
				</label>
				<div class="col-lg-10 col-md-8">
					<input type="checkbox" style="height: 20px;width: 20px;" onchange="$('#mqtt_req_pass').toggle('slow');" name="mqtt_auth" value="1" [#if MQTT_AUTH="1" #] checked[#endif#]>
				</div>
			</div>
			
			<div id="mqtt_req_pass" style="display:none;">
				<div class="form-group " style="margin-right: 0px;margin-left: 0px;">
					<label class="col-lg-2 col-md-4" style="max-width: 240px;float: left;padding: 5px 10px 0px 0px;text-align: right;">
						<#LANG_NEW_MQTT_USERNAME#>:
					</label>
					<div class="col-lg-10 col-md-8">
						<input type="text" name="mqtt_username" value="<#MQTT_USERNAME#>" class="form-control">
					</div>
				</div>
				<div class="form-group " style="margin-right: 0px;margin-left: 0px;">
					<label class="col-lg-2 col-md-4" style="max-width: 240px;float: left;padding: 5px 10px 0px 0px;text-align: right;">
						<#LANG_NEW_MQTT_PASSWORD#>:
					</label>
					<div class="col-lg-10 col-md-8">
						<input type="text" name="mqtt_password" value="<#MQTT_PASSWORD#>" class="form-control">
					</div>
				</div>
			</div>
			<div class="form-group" style="margin-right: 0px;margin-left: 0px;">
				<div class="col-md-12 text-center">
					<button type="submit" name="subm" value="Submit" class="btn btn-success">
						<i class="glyphicon glyphicon-floppy-saved" style="font-size: 1.2rem;"></i>
						<#LANG_UPDATE#>
					</button>
					<input type="hidden" name="view_mode" value="update_settings">
					<input type="hidden" name="mode" value="update">
				</div>
			</div>
		</form>
	</div>
</div>

<div class="row" style="margin-right: -15px;margin-left: -15px;display:none;margin-bottom:10px;" id="filter">
	<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
		<form action="?" method="get" name="frmFilter">
			<div class="col-md-3" style="padding-left: 0px;">
				<input type="text" name="title" value="<#TITLE#>" class="form-control" style="margin-bottom: 5px;" placeholder="<#LANG_SEARCH#>">
			</div>
			<div class="col-md-4">
				<select class="form-control" name="searchpath" style="margin-bottom: 5px;">
					<option value="0">
						<#LANG_FILTER_BY_CLASS#> (<#LANG_ALL#>)
								[#begin PATHS#]
					<option value="[#path#]" [#if path="<#SEARCH#>" #] selected[#endif#]>[#path#]</option>
					[#end PATHS#]
				</select>
			</div>
			<div class="col-md-4">
				<select class="form-control" name="location_id" style="margin-bottom: 5px;">
					<option value="0">
						<#LANG_FILTER_BY_LOCATION#> (<#LANG_ALL#>)
								[#begin LOCATIONS#]
					<option value="[#ID#]" [#if ID="<#LOCATION_ID#>" #] selected[#endif#]>[#TITLE#]</option>
					[#end LOCATIONS#]
				</select>
			</div>
			<div class="col-md-1">
				<button type="submit" name="submit" style="margin-bottom: 5px;" class="btn btn-info"><i class="glyphicon glyphicon-search" style="font-size: 1.2rem;"></i>
					<#LANG_SEARCH#>
				</button>
			</div>
		</form>
	</div>
</div>

<div class="row" style="margin-right: -15px;margin-left: -15px;">
	<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
		[#if RESULT#]
		[#if PAGES#]
		<div class="row" style="margin-right: -15px;margin-left: -15px;">
			<div class="col-md-12 text-center">
				<ul class="pagination pagination-sm">
					[#begin PREVPAGE#]<li><a href="?view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&laquo;</a></li>[#end PREVPAGE#]
					[#begin PAGES#]
					<li [#if SELECTED#]class="active" [#endif#]><a href="?view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">[#NUM#]</a></li>
					[#end PAGES#]
					[#begin NEXTPAGE#]<li><a href="?view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&raquo;</a></li>[#end NEXTPAGE#]
				</ul>
			</div>
		</div>
		[#endif PAGES#]
		
		
		[#if TREE="1"#]
		<style type="text/css">
			.HandCursorStyle {
				cursor: pointer;
				cursor: hand;
			}
		</style>
		
		<script type="text/JavaScript">
			// Add this to the onload event of the BODY element
			function addEvents() {
			  activateTree(document.getElementById("LinkedList1"));
			}

			// This function traverses the list and add links 
			// to nested list items
			function activateTree(oList) {
			  // Collapse the tree
				/*
			  for (var i=0; i < oList.getElementsByTagName("ul").length; i++) {
				oList.getElementsByTagName("ul")[i].style.display="none";            
			  }
																			 */
			  // Add the click-event handler to the list items
			  if (oList.addEventListener) {
				oList.addEventListener("click", toggleBranch, false);
			  } else if (oList.attachEvent) { // For IE
				oList.attachEvent("onclick", toggleBranch);
			  }
			  // Make the nested items look like links
			  addLinksToBranches(oList);
			}

			function rememberBranchStatus(title, status) {
				var url="?ajax=1&op=branch_status&status="+status+"&branch="+encodeURIComponent(title);
				$.ajax({
					url: url
				}).done(function(data) {
					//alert(data);
				});
			}

			// This is the click-event handler
			function toggleBranch(event) {
			  var oBranch, cSubBranches;
			  if (event.target) {
				oBranch = event.target;
			  } else if (event.srcElement) { // For IE
				oBranch = event.srcElement;
			  }
			  cSubBranches = oBranch.getElementsByTagName("ul");
			  if (cSubBranches.length > 0) {
				if (cSubBranches[0].style.display != "none") {
				  $(cSubBranches[0]).hide('slow');
				  rememberBranchStatus(oBranch.title,0);
				} else {
				  $(cSubBranches[0]).show('slow');
				  rememberBranchStatus(oBranch.title,1);
				}
			  }
			}

			// This function makes nested list items look like links
			function addLinksToBranches(oList) {
			  var cBranches = oList.getElementsByTagName("li");
			  var i, n, cSubBranches;
			  if (cBranches.length > 0) {
				for (i=0, n = cBranches.length; i < n; i++) {
				  cSubBranches = cBranches[i].getElementsByTagName("ul");
				  if (cSubBranches.length > 0) {
					addLinksToBranches(cSubBranches[0]);
					cBranches[i].className = "HandCursorStyle";
					//cBranches[i].style.fontWeight="bold";
					cSubBranches[0].style.color = "black";
					cSubBranches[0].style.fontWeight = "normal";
					cSubBranches[0].style.cursor = "auto";
				  }
				}
			  }
			}
		</script>
		<ul id="LinkedList1" class="LinkedList" style="padding-left: 0px;">
			[#begin RESULT#]
			<li style="list-style-type: none; color:[#COLOR#]" title="[#TITLE#]" onmouseout="$(this).find('.delIcon').hide().removeClass('text-danger');" onmouseover="$(this).find('.delIcon').show().addClass('text-danger');">
				[#if RESULT#]<i class="glyphicon glyphicon-folder-close" style="font-size: 1.2rem;"></i>[#else#]<i class="glyphicon glyphicon-arrow-right" style="font-size: 1.2rem;color: #ddd;"></i>[#endif RESULT#]
				[#if ID!=""#]
				
				<a href="?view_mode=edit_mqtt&id=[#ID#]" title="[#PATH#]" style="color:[#if COLOR!=''#][#COLOR#][#else COLOR#]#333[#endif COLOR#];text-decoration: none;">
					[#if TITLE!=""#][#TITLE#][#else TITLE#][..][#endif TITLE#]
				</a>
				: <span id="mqtt[#ID#]" class="mqtt_value">[#VALUE#]</span>
				[#if LINKED_OBJECT!=""#]<i>([#LINKED_OBJECT#].[#LINKED_PROPERTY#])</i>[#endif LINKED_OBJECT#]
				[#else#]
				&nbsp;[#TITLE#]
				[#endif#]
				
				<a href="?view_mode=delete_path&path=[#PATH_URL#]" onclick="return confirm('<#LANG_ARE_YOU_SURE#>');"><i style="display: none;" class="glyphicon glyphicon-remove delIcon"></i></a>
				[#if RESULT#]<ul [#if IS_VISIBLE!="1" #] style="display:none" [#endif#]>[#tree RESULT#]</ul>[#endif RESULT#]
			</li>
			[#end RESULT#]
		</ul>
		<script type="text/JavaScript">
			addEvents();
		</script>
		[#else TREE#]
		<div class="table-responsive">
		<table class="table table-stripped table-bordered" style="font-size: 1.4rem;">
			<thead>
				<tr>
					<th class="text-center">
						<a href="?sortby_mqtt=TITLE&save_qry=1">
							<#LANG_TITLE#>
						</a>
						<nobr>
							[#if SORTBY="TITLE"#](+)[#endif#]
							[#if SORTBY="TITLE DESC"#](-)[#endif#]</nobr>
					</th>
					<th class="text-center">
						<#LANG_UPDATED#>
					</th>
					<th class="text-center">
						<#LANG_VALUE#>
					</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
				[#begin RESULT#]
				<tr>
					<td>
						<a href="?view_mode=edit_mqtt&id=[#ID#]" style="text-decoration: none;color: #333;"><b>[#TITLE#]</b></a>
						
						[#if PATH!=""#]<br>[#PATH#][#endif#]
						[#if LINKED_OBJECT!=""#]
						<p style="color: gray;font-size: 1.2rem;margin: 0px;">↳ <span class="label label-success">[#LINKED_OBJECT#].[#LINKED_PROPERTY#]</span></p>
						[#endif LINKED_OBJECT#]
					</td>
					<td width="15%">
						[#if UPDATED!=""#]
						[#UPDATED#]
						[#else#]
						&nbsp;
						[#endif#]
					</td>
					<td>
						<span id="mqtt[#ID#]" class="mqtt_value">[#VALUE#]</span>
					</td>
					<td width="10%" class="text-center" style="vertical-align: middle;">
						[#if "<#ACTION#>"=="admin"#]
							<div class="btn-group">
								<a href="?view_mode=edit_mqtt&id=[#ID#]" class="btn btn-warning btn-sm" title="<#LANG_EDIT#>"><i class="glyphicon glyphicon-pencil"></i></a>
								<a href="?view_mode=delete_mqtt&id=[#ID#]" onClick="return confirm('<#ARE_YOU_SURE#>')" class="btn btn-danger btn-sm" title="<#LANG_DELETE#>"><i class="glyphicon glyphicon-remove"></i></a>
							</div>
							
						[#endif ACTION#]
					</td>
				</tr>
				[#end RESULT#]
			</tbody>
		</table>
		</div>
		[#endif TREE#]
		
		[#if PAGES#]
		<div class="row" style="margin-right: -15px;margin-left: -15px;">
			<div class="col-md-12 text-center">
				<ul class="pagination pagination-sm">
					[#begin PREVPAGE#]<li><a href="?view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&laquo;</a></li>[#end PREVPAGE#]
					[#begin PAGES#]
					<li [#if SELECTED#]class="active" [#endif#]><a href="?view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">[#NUM#]</a></li>
					[#end PAGES#]
					[#begin NEXTPAGE#]<li><a href="?view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&raquo;</a></li>[#end NEXTPAGE#]
				</ul>
			</div>
		</div>
		[#endif PAGES#]

		[#else RESULT#]
		<p>
		<div class="alert alert-danger">
			<#LANG_NO_RECORDS_FOUND#>
		</div>
		</p>
		[#endif RESULT#]
	</div>
</div>
